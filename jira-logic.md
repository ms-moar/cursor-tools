# Логики и Интеграции Системы Cursor Memory Bank

Этот документ суммирует основные логики работы, интеграции с Jira, Confluence и DevOps-инструментами, а также правила управления задачами и файлами, внедренные в проект `cursor-memory-bank`.

## Общая Логика Проекта (Cursor Memory Bank)

*   **Система Управления Задачами и Рабочим Процессом:** Модульная система для управления задачами разработки, интегрированная с редактором Cursor.
*   **Режимы/Фазы:** Используются именованные режимы (`VAN`, `PLAN`, `CREATIVE`, `IMPLEMENT`, `QA`, `REFLECT`, `ARCHIVE`) для структурирования процесса разработки.
*   **Изолированные Правила:** Правила для ИИ загружаются "на лету" (Just-In-Time) для активного режима. Хранятся в `.cursor/rules/isolation_rules/`.
*   **Визуальные Карты:** Процессы каждого режима детализированы в визуальных картах (файлы `*.mdc` в `visual-maps/`).
*   **Конфигурация (`integration_config.md`):** Центральный файл для настроек интеграций, глобальных правил проекта, включая мультипроектные контексты.
*   **`tasks.md`:** Предполагается, что этот файл создается и управляется системой во время выполнения. Служит локальным представлением задач из разных проектов, синхронизированным с Jira. Каждая задача в `tasks.md` должна содержать `JIRA_PROJECT_KEY`, `JIRA_ISSUE_ID`, оценку в Story Points (SP) и `Context Name`.

## Ключевые Внедренные Логики и Интеграции

### 1. Интеграция с Jira (Полуавтоматическая)

*   **Управление через MCP:** Все взаимодействия с Jira (создание, обновление, поиск задач) выполняются через MCP-инструменты (`mcp_mcp-atlassian_jira_*`).
*   **Подтверждение Пользователем:** Система предлагает действия в Jira, пользователь должен их одобрить для выполнения.
*   **Мультипроектная Конфигурация:** `integration_config.md` поддерживает настройку нескольких "Проектных Контекстов", каждый со своими ключами Jira (`jira_project_key`, `jira_default_issue_type`, `jira_status_mapping`).
*   **Выбор Активного Контекста:** В начале каждого режима, работающего с Jira, ИИ должен запрашивать у пользователя, для какого проектного контекста выполняется операция (если определено несколько). В рамках одного диалога (сессии ИИ) работа ведется с одним выбранным контекстом.
*   **Работа с Эпиками (в `PLAN` режиме):**
    *   ИИ анализирует задачу. Если она сложная и не связана с эпиком, предлагает пользователю создать новый Эпик или привязать к существующему.
    *   Для "маленьких" Эпиков (общий SP < 7) предлагается не создавать отдельные задачи в Jira, а включить их список в описание самого Эпика.
*   **Story Points (SP):**
    *   **Оценка ИИ (финальная):** ИИ самостоятельно определяет и назначает окончательную оценку в SP для каждой задачи на этапе `PLAN`. Эта оценка не подлежит ревью пользователем.
    *   **Хранение в Jira:** SP указываются как текст в поле **описания** задачи/эпика в Jira.
    *   **Формула:** `1 SP = 8 часов разработчика = 10 минут ИИ` (из `integration_config.md`, используется ИИ как ориентир).
*   **Синхронизация Задач с `tasks.md`:**
    *   ИИ должен проверять статусы задач в Jira и предлагать обновления для `tasks.md` для поддержания консистентности (статус, имя, SP, контекст).
*   **Проверка Задач "В Работе":**
    *   Перед взятием задачи в работу ИИ проверяет ее статус и исполнителя в Jira, предлагает смену исполнителя на текущего пользователя.
*   **Обновление Статусов Jira:** По завершении ключевых этапов (`PLAN`, `CREATIVE`, `IMPLEMENT`, `QA`, `REFLECT`) ИИ предлагает обновить статус соответствующей задачи в Jira.

### 2. Интеграция с Confluence (Полуавтоматическая)

*   **Создание Страниц:** В конце режимов `CREATIVE` (дизайн-документация) и `ARCHIVE` (сводка по задаче) ИИ предлагает создать/обновить страницу в Confluence.
*   **Конфигурация:** `integration_config.md` содержит `confluence_space_key` для каждого проектного контекста.

### 3. Интеграция с DevOps Инструментами (GitLab, Vercel)

*   **Папка `devops-tools/`:** Содержит скрипты для автоматизации CI/CD.
*   **Режим `IMPLEMENT`:** После `git push` ИИ предлагает проверить статус GitLab пайплайна. При успехе и если используется Vercel (запрос к пользователю), предлагается проверить/запустить деплой Vercel.
*   **Режим `QA`:** Может включать проверку конфигурации GitLab CI/Vercel, запуск диагностических скриптов, проверку логов.
*   **Режим `ARCHIVE`:** Предлагается создать релизный тег в GitLab. Опционально проверяется деплой Vercel.
*   **Конфигурация:** `integration_config.md` содержит URL/ID для GitLab и Vercel для каждого проектного контекста.
*   **Иерархическое Ветвление Git (Новое)**:
    *   **Ветки Эпиков/Фаз**: В режиме `PLAN` ИИ предлагает создать долгоживущие ветки для Эпиков или крупных фаз (например, `epic/[JIRA_EPIC_KEY]`) от основной ветки разработки контекста.
    *   **Ветки Задач**: В режимах `CREATIVE` и `IMPLEMENT` ИИ предлагает создавать ветки для конкретных задач (например, `feature/[JIRA_TASK_KEY]`). Если существует родительская ветка эпика для данной задачи, ветка задачи создается от ветки эпика. В противном случае – от основной ветки разработки контекста.
    *   Это помогает лучше организовать код, связанный с крупными блоками функциональности.

### 4. Правила Работы с Файлами и Системой

*   **Бэкап перед Удалением:** В `main.mdc` внедрено правило: перед удалением файла ИИ создает его резервную копию в `backup-files/`.
*   **Создание `docs/architecture.md`:** В `VAN` режиме ИИ предлагает создать файл архитектуры. В `CREATIVE` и `IMPLEMENT` напоминает о его обновлении.
*   **AI Communication Protocol:** В `main.mdc` добавлено правило, что ИИ каждое сообщение начинает с указания текущего проекта и рабочей папки.

### 5. Структура и Управление Проектом

*   **Работа в рамках Одного Диалога для Одного Проекта:** Логика ИИ ориентирована на работу с одним выбранным "проектным контекстом" в рамках одной сессии.
*   **Использование `tasks.md` (когда создается системой):** Файл служит локальным представлением задач из разных проектов. Каждая строка содержит `JIRA_PROJECT_KEY`, `JIRA_ISSUE_ID`, `SP` и `Context Name`. ИИ отвечает за его создание (если отсутствует) и синхронизацию с Jira. 